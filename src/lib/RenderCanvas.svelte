<script lang="ts">
	import { onMount } from 'svelte';
	import { colors, pixelHeight, pixelSize, pixelWidth, eraserColor, indexs } from "$lib/consts";
	let bytes: string = "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000010001000000000010000000000000000000000000000000000000001100100000000001000000000000111000000000000000000000000101010000000000100000100000000100000011100000000000000010101011100000010000011111001110111001010000000000000001001101010000001000001010100101010100111000000000000000100010111000111111100101010011101110010000000000000000000000000000000000000000000000000001001110000000000000000000000000000000000000000000000011100000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000002220000111000000222000000000000002000000000000000000000212000000000000021200000000000002220000000000000000000021200000000000002120000000000000212000000000000000000002120000000000000212200000000000021200000000000000000000212000000000000021220000000000002120000000000000000000021200000000000002112000000000002212000022222002222200002120022222220022221200000000000212200022111222211122222212222111122022111120000000000221200002122211221211221111221122221222112112000000000221120000212022122121122122122111111222112221200000000221122222221222212211122212212212222222212222120000000221111111112111112222222021111221122212021122112000000021122222222222222200000002222222211111202211112200000002222000000000000000000000000000022222220022222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

	let canvas: HTMLCanvasElement;
	let ctx: CanvasRenderingContext2D;

	export function change_bytes (newBytes: string) {
		bytes = newBytes;
		load_pixels();
	}

	function load_pixels(){
		// Remplir le tableau de pixels avec des valeurs al√©atoires
		for (let i = 0; i < pixelHeight; i++) {
			for (let j = 0; j < pixelWidth; j++) {
				// pixels[i][j] = Math.floor(Math.random() * 2);

				const currentByte = bytes.charAt(i * pixelWidth + j) || "0";
				const current_pixels = indexs.findIndex((b) => b === currentByte);

				ctx.fillStyle = colors[current_pixels];
				ctx.fillRect(j * pixelSize, i * pixelSize, pixelSize, pixelSize);
			}
		}
	}

	onMount(() => {
		canvas = document.getElementById('main-canvas') as HTMLCanvasElement;
		ctx = canvas.getContext("2d") as CanvasRenderingContext2D;

		load_pixels();
	});

</script>

<canvas id="main-canvas" width={pixelWidth * pixelSize} height={pixelHeight * pixelSize}>
</canvas>
<style>
	canvas {
		border: 1px solid black;
	}
</style>